<!DOCTYPE html>  
<html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>Bina PlanÄ±</title>  
    <link rel="icon" type="image/png" href="img/icon.png" sizes="32x32">
    <!-- Bootstrap CSS -->  
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/index.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>  

    <style>  
    
/* ---- Temel VarlÄ±klar ---- */
body {
  background: linear-gradient(to bottom, #ede9de 0%, #eef1f7 100%);
  min-height: 100vh;
  font-family: "Varela Round", Arial, sans-serif;
  margin: 0; padding: 0;
}

/* ---- KÄ±sa MenÃ¼ BarÄ± ---- */
.custom-short-menu {
  display: flex;
  gap: 22px;
  justify-content: center;
  align-items: flex-start;
  width: 100%;
  margin: 18px 0 10px 0;
}
.menu-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 70px;
  text-decoration: none;
  background: none;
  border: none;
  transition: color 0.18s, background 0.18s;
  cursor: pointer;
  outline: none;
}
.menu-btn img {
  width: 32px;
  height: 32px;
  margin-bottom: 4px;
}
.menu-btn span {
  font-size: 14px;
  color: #333;
}
.menu-btn:hover span, .menu-btn:focus span {
  color: #1d67c4;
  font-weight: 500;
}
#buttonHome { margin-right: 18px; }

/* ---- Navbar ve ProjectName (sol Ã¼st) ---- */
.container-fluid {
  display: flex;
  flex: 0 0 100%;
  flex-wrap: nowrap;
  align-items: center;
}
#projectName {
  flex: 0 0 90%;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-family: Arial, sans-serif;
  font-size: 36px;
}
.img-fluid {
  flex: 0 0 auto;
  height: 30px;
  width: 30px;
  margin-right: 10px;
}

/* ---- Butonlar ---- */
.custom-btn {
  background-color: #847539;
  color: #fff;
  border: none;
  border-radius: 10px;
  padding: 10px 20px;
  font-family: "Varela Round";
  font-size: 16px;
  font-weight: bold;
  letter-spacing: 2px;
  cursor: pointer;
  transition: background-color 0.3s;
  margin-right: 40px;
}
.custom-btn:hover, .custom-btn:focus {
  background-color: #67552A;
}

/* ---- SÃ¼reÃ§ BaÅŸlÄ±ÄŸÄ± ---- */
.surec-title {
  font-family: 'Oswald', sans-serif;
  font-size: 2.1rem;
  font-weight: bold;
  text-align: center;
  color: #67552A;
  margin: 32px 0 36px 0;
}

/* ---- SÃ¼reÃ§ AdÄ±mlarÄ± (Yatay Tab Bar) ---- */
.flow-steps-container {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
  gap: 0.5em;
  padding: 1.25em 0 2em 0;
}
.flow-step-btn {
  font-family: inherit;
  background: #fff;
  color: #333;
  border: 2px solid #e2e8f0;
  border-radius: 2em;
  font-weight: 500;
  font-size: 1.08em;
  padding: 0.65em 1.5em;
  display: flex;
  align-items: center;
  cursor: pointer;
  box-shadow: 0 2px 8px 0 #e5ecf7;
  transition: color 0.14s, background 0.16s, border-color 0.16s;
  outline: none;
  position: relative;
}
.flow-step-btn.active, .flow-step-btn:focus {
  background: linear-gradient(90deg, #2563eb 0%, #60a5fa 70%);
  color: #fff;
  border-color: #468ef9;
  box-shadow: 0 4px 16px 0 #cbd9fd;
  z-index: 1;
}
.flow-step-arrow {
  display: flex;
  align-items: center;
  height: 30px;
}
.flow-step-arrow svg {
  display: block;
  width: 28px;
  height: 30px;
  stroke: #d1d5db;
  stroke-width: 2.5;
  fill: none;
}

/* ---- Evrak Ä°ÅŸleri (Accordion KutularÄ±) ---- */
.surec-section { display: none; }
.surec-section.active { display: block; animation: fadein 0.5s; }
@keyframes fadein {
  from { opacity: 0; transform: translateY(20px);}
  to { opacity: 1; transform: translateY(0);}
}
.bolum-baslik {
  font-family: 'Oswald', sans-serif;
  font-size: 1.26rem;
  color: #5b74e6;
  font-weight: 700;
  margin-bottom: 1.2rem;
  letter-spacing: 0.5px;
  text-align: center;
  margin-top: 4px;
}
.alt-kutu-icerik { 
  display: none; 
}
.alt-baslik-kutu[aria-expanded="true"] + .alt-kutu-icerik { 
  display: block; 
}
.er-kutular {
  width: 100%;
  max-width: 750px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 1.1rem;
}
.alt-baslik-kutu {
  background: linear-gradient(90deg, #f7ecd2 0%, #e3e7fa 100%);
  border-radius: 1.4rem;
  box-shadow: 0 4px 14px 0 rgba(160,160,160,0.07);
  padding: 1.0rem 1.25rem 1.08rem 1.31rem;
  border: none;
  display: flex;
  width: 100%;
  cursor: pointer;
  position: relative;
  font-family: 'Oswald', Arial, sans-serif;
  font-size: 1.07rem;
  font-weight: 700;
  color: #2c2c21;
  transition: background .18s, box-shadow .18s, color .17s;
  text-align: left;
}
.alt-baslik-kutu:hover, .alt-baslik-kutu:focus {
  background: linear-gradient(90deg, #f2e5be 0%, #cbd8f3 100%);
  color: #2857ad;
  box-shadow: 0 8px 22px 0 rgba(120,140,190,0.12);
  outline: none;
}
.alt-kutu-arrow {
  position: absolute;
  right: 18px;
  top: 50%;
  transform: translateY(-50%) rotate(0deg);
  transition: transform .25s cubic-bezier(.43,1.16,.45,1.13);
  font-size: 1.08em;
  pointer-events: none;
  color: #caad2e;
}
.alt-baslik-kutu[aria-expanded="true"] .alt-kutu-arrow {
  transform: translateY(-50%) rotate(90deg);
  color: #4a75e0;
}
.alt-kutu-icerik {
  background: #f7ecd2;
  border-radius: 0 0 1rem 1rem;
  margin-top: -6px;
  box-shadow: 0 2px 8px 0 rgba(180,180,180,0.08);
  padding: 0.7rem 1.7rem 1.08rem 1.7rem;
  animation: fadein .4s;
  width: 100%;
}
.alt-kutu-icerik ul { margin-bottom: 0; }
.alt-kutu-icerik li {
  font-family: "Varela Round", Arial, sans-serif;
  font-size: 1rem;
  color: #312e21;
  margin-bottom: 0.43rem;
}

/* ---- Evrak Ekle Butonu ---- */
.evrak-ekle-btn {
  display: block;
  margin: 50px auto 0 auto;
  font-family: "Oswald", Arial, sans-serif;
  font-size: 1.15rem;
  background: linear-gradient(90deg, #e3e7fa 0%, #f7ecd2 100%);
  border-radius: 14px;
  border: none;
  color: #3560bd;
  padding: 0.8rem 1.7rem;
  font-weight: 700;
  box-shadow: 0 2px 10px 0 rgba(180,180,180,0.10);
  transition: background .2s, color .2s, box-shadow .14s;
  letter-spacing: 1px;
}
.evrak-ekle-btn:hover, .evrak-ekle-btn:focus {
  background: linear-gradient(90deg, #f7ecd2 0%, #e3e7fa 100%);
  color: #1d4188;
  box-shadow: 0 4px 17px 1px rgba(80,100,200,0.13);
  outline: none;
}

/* ---- Ãœretim AdÄ±mlarÄ± KutularÄ± ---- */
.uretim-steps-row {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 8px;
  justify-content: center;
  margin: 20px 0 0 0;
}
.uretim-step-btn {
  background: linear-gradient(90deg, #f7ecd2 0%, #e3e7fa 100%);
  color: #2c2c21;
  border-radius: 12px;
  border: none;
  font-family: 'Oswald', Arial, sans-serif;
  font-size: 1.01rem;
  font-weight: 700;
  padding: 0.33rem 1.17rem;
  transition: background .14s, color .13s, box-shadow .14s;
  box-shadow: 0 2px 8px 0 rgba(120,140,190,0.09);
  cursor: pointer;
  margin: 5px 0;
  position: relative;
  white-space: nowrap;
}
.uretim-step-btn:hover, .uretim-step-btn:focus {
  background: linear-gradient(90deg, #f2e5be 0%, #cbd8f3 100%);
  color: #3560bd;
  box-shadow: 0 6px 18px 0 rgba(120,140,190,0.17);
  outline: none;
}
.uretim-step-ok {
  display: flex;
  align-items: center;
  margin: 0 3px;
  z-index: 1;
}
.uretim-step-ok svg {
  width: 34px;
  height: 14px;
  color: #d6b739;
  stroke-width: 5px;
  stroke: #d6b739;
  fill: none;
  vertical-align: middle;
}
#tab-uretim .bolum-baslik {
  font-family: 'Oswald',sans-serif;
  font-size:2.2rem;
  color: #3560bd;
  font-weight: 800;
  border-radius: 18px;
  padding: 1.2em 1.3em .9em 1.3em;
  margin-bottom:2.2rem;
  box-shadow:0 6px 36px 0 rgba(44, 83, 180, 0.10);
  text-align:center;
  text-shadow:0 2px 8px #e6eefd;
  letter-spacing:.03em;
}
.bolum-baslik {
  background: none;
  box-shadow: none;
}
/* Soft glassy tablar */
.uretim-tabs-row {
  display:flex; gap:15px; justify-content:center; margin-bottom:1.6rem;
  flex-wrap:wrap;
}
.uretim-tab-btn {
  position:relative;
  appearance:none;
  outline:none;
  border:none;
  font-family:'Oswald',Arial,sans-serif;
  font-size:1.17rem;
  font-weight:700;
  padding:.86em 2.2em .86em 2.6em;
  border-radius:18px;
  background:
    linear-gradient(90deg,#e0e7fa88 0%, #ede9decc 100%);
  color: #2857ad;
  box-shadow:0 4px 16px 0 #d8e5ef77;
  backdrop-filter:blur(7px) saturate(130%);
  transition:all .19s cubic-bezier(.47,1.7,.39,.88);
  letter-spacing:.07em;
  border:2.6px solid transparent;
  margin-bottom:0;
  cursor:pointer;
  min-width: 140px;
  display:flex;
  gap:.5em;
  align-items:center;
}
.uretim-tab-btn:hover, .uretim-tab-btn:focus {
  color: #fff;
  background:linear-gradient(98deg,#bad0fc66 0%, #fefae28f 88%);
  box-shadow:0 10px 30px 0 #c5d9ff55, 0 2px 8px #e2e6ec11;
}

.uretim-tab-btn:focus,
.uretim-tab-btn:active,
.uretim-tab-btn:focus-visible {
  outline: none !important;
  box-shadow: none !important;
  color: #000000;
}
.uretim-tab-btn .uretim-ikon {
  font-size:1.27em; 
  opacity:.82;
  margin-right:.25em;
  margin-top:-2px;
  display:inline-block;
  filter:drop-shadow(0 1px 0 #eef6ff77);
}

/* ---- Modal ve File List ---- */
.modal-xl { --bs-modal-width:950px; }
#modalUretim .file-list { max-height:180px; overflow:auto; }

#geriRadyalBtn {
  float: none !important;     /* Bootstrap float'Ä± devreden Ã§Ä±kar */
  display: block;             /* Tam satÄ±r kaplasÄ±n */
  margin-left: 0;
  margin-bottom: 8px;
}
#modalContentGenel > .row {
  justify-content: center !important;
}


/* ---- Responsive Break Points ---- */
@media (max-width:820px){
  .uretim-steps-row { flex-wrap: wrap; }
  .uretim-step-btn { font-size:0.98rem; padding:.28rem 0.87rem;}
  .uretim-step-ok svg { width:22px; height:10px; }
}

/* -- <600px: TÃ¼m sÃ¼reÃ§ adÄ±mlarÄ± ve menÃ¼ler dikeyleÅŸiyor, paddings/kÃ¼Ã§Ã¼lÃ¼yor -- */
@media (max-width:600px){
  .container-navbar { flex-wrap: wrap; justify-content: flex-end; }
  #projectName {
    flex: 0 0 70%;
    font-size: 17px !important; max-width: 65%; min-width: 0; margin-right: 0;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left;
  }
  #buttonHome { flex: 0 0 30px; padding: 0; margin-left: 0; display: flex; align-items: center;}
  .img-fluid { height: 28px; width: 28px; margin-right: 0; margin-left: 0; }
  .custom-btn { font-size: 12px; padding: 5px 10px; border-radius: 6px; color: #fff; border: none; margin-right: 12px; font-weight: 500; }
  .navbar-toggler { background-color: #c2c5c9; flex: 0 0 auto; margin-left: auto; justify-content: flex-end;}
  .container-fluid { flex-wrap: wrap; }
  .custom-short-menu {
    gap: 12px; width: 90%!important; margin-top: 12px; margin-left:auto; margin-right:auto;
  }
  .menu-btn { flex: 1 1 0; min-width: 0; }
  .menu-btn img { width: 25px; height: 25px; margin-bottom: 4px;}
  .menu-btn span { font-size: 0.8rem; white-space: nowrap; text-align: center;}
  .flow-steps-container { flex-direction: column; gap: .1em; }
  .flow-step-arrow { transform: rotate(90deg); height: 24px; }
  .flow-step-arrow svg { width: 22px; height: 20px; }
  .flow-step-btn { width: 100%; justify-content: center; }
  .surec-title { font-size: 1.5em; margin-bottom: 10px; }
  #tab-uretim .bolum-baslik { font-size:1.29rem; padding:.9em .33em .7em .33em; }
  .uretim-tabs-row{ gap:7px;}
  .uretim-tab-btn{ font-size:1.01rem; padding:.6em 1em .66em 1.4em; border-radius:13px; min-width:94px;}
  .uretim-tab-btn .uretim-ikon {font-size:1em;}
  .evrak-ekle-btn { font-size: 0.9rem; padding: 0.6rem 1.4rem;}
  .alt-baslik-kutu{font-size:0.95rem; padding:.75rem 1.1rem;}

  #geriRadyalBtn {
    float: right !important;  /* BÃ¼yÃ¼k ekranda saÄŸa geÃ§ebilir */
    display: inline-block;
    margin-left: auto;
    margin-bottom: 10px !important;
  }
  #modalContentGenel > .row > .col-lg-7,
  #modalContentGenel > .row > .col-lg-5 {
    padding-left: 0 !important;
    padding-right: 0 !important;
    align-items: center;
  }
  #modalContentGenel .card {
    width: 90vw;
  }
}

/* --- Ekstra - ScrollbarlarÄ±nÄ± yumuÅŸatmak isteyenler iÃ§in (isteÄŸe baÄŸlÄ±) --- */
.er-kutular, .file-list { scrollbar-width: thin; scrollbar-color: #bfcfe5 #fafafa;}
.er-kutular::-webkit-scrollbar, .file-list::-webkit-scrollbar { width:7px; background:#fafafa;}
.er-kutular::-webkit-scrollbar-thumb, .file-list::-webkit-scrollbar-thumb { background: #bfcfe5; border-radius: 6px;}
</style>
</head>  
<body>  

    <!-- Responsive Header -->  
    <nav class="header d-flex justify-content-between align-items-center px-3">
        <span class="d-flex align-items-center gap-2">
            <img src="img/icon.png" alt="Logo" width="32" height="32">
            YapÄ±o
        </span>
        <button class="btn custom-btn" id="loginButton" style="display: none;">PROJELER</button>  
    </nav>

    <!-- Navbar -->  
    <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top shadow-sm mt-4 container-navbar">  
        <div class="container-fluid">  
            <!-- Proje AdÄ± -->  
            <h4 class="navbar-brand" id="projectName">Proje AdÄ±</h4>  
            <!-- Ana Sayfa Butonu -->  
            <button class="btn d-flex navbar-home-button" id="buttonHome">  
                <img src="img/home1_1.png" alt="Katlar GÃ¶rseli" class="img-fluid rounded">  
            </button>
        </div>  
    </nav> 

    <div class="custom-short-menu" id="regulation-button-area">
        <a class="menu-btn" id="quatation-button" href="#">
            <img src="img/pay1_1.png" alt="">
            <span>Giderler</span>
        </a>
        <a class="menu-btn" id="graphs-button" href="#">
            <img src="img/growth_1.png" alt="">
            <span>Analizler</span>
        </a>
        <a class="menu-btn" id="sold-button" href="#">
            <img src="/img/property.png" alt="">
            <span>SatÄ±ÅŸ</span>
        </a>
    </div>

    <div id="loader" style="display:none;">
        <div class="spinner"></div>
        <span>YÃ¼kleniyor...</span>
    </div>

    <div class="container pt-3 pb-4">  
      <div class="surec-title">YapÄ± Ãœretim SÃ¼reci</div>  
      <div class="flow-steps-container">
        <button class="flow-step-btn active" data-tab="evrak">
          Evrak Ä°ÅŸleri
        </button>
        <span class="flow-step-arrow">
          <svg viewBox="0 0 24 24">
            <polyline points="4,12 20,12"/>
            <polyline points="16,7 20,12 16,17"/>
          </svg>
        </span>
        <button class="flow-step-btn" data-tab="ruhsat">
          YapÄ± RuhsatÄ±
        </button>
        <span class="flow-step-arrow">
          <svg viewBox="0 0 24 24">
            <polyline points="4,12 20,12"/>
            <polyline points="16,7 20,12 16,17"/>
          </svg>
        </span>
          <button class="flow-step-btn" data-tab="uretim">
            Ãœretim
          </button>
        </div>
      </div>

    <!-- Evrak Ä°ÅŸleri BÃ¶lÃ¼mÃ¼ -->  
    <div class="surec-section mb-4 active" id="tab-evrak">  
  <div class="bolum-baslik">Evrak Ä°ÅŸleri</div>  
  <div class="er-kutular">  
    <div class="alt-baslik-kutu" tabindex="0" aria-expanded="false">  
      <span class="alt-baslik-ikon">ğŸ›ï¸</span>  
      Belediye  
      <span class="alt-kutu-arrow">&#9654;</span>  
    </div>  
    <div class="alt-kutu-icerik">  
      <ul>  
        <li data-kurum="Belediye" data-detay="Aflikasyon">Aplikasyon</li>  
        <li data-kurum="Belediye" data-detay="Ä°mar durumu">Ä°mar durumu</li>  
        <li data-kurum="Belediye" data-detay="Kanal kotu">Kanal kotu</li>  
        <li data-kurum="Belediye" data-detay="Ruhsat harcÄ±">Ruhsat harcÄ±</li>  
        <li data-kurum="Belediye" data-detay="Zemin etÃ¼dÃ¼ harcÄ±">Zemin etÃ¼dÃ¼ harcÄ±</li>  
      </ul>  
    </div>  
    <div class="alt-baslik-kutu" tabindex="0" aria-expanded="false">  
      <span class="alt-baslik-ikon">ğŸ–‹ï¸</span>  
      Noter  
      <span class="alt-kutu-arrow">&#9654;</span>  
    </div>  
    <div class="alt-kutu-icerik">  
      <ul>  
        <li data-kurum="Noter" data-detay="MÃ¼teahhitlik sÃ¶zleÅŸmesi">MÃ¼teahhitlik sÃ¶zleÅŸmesi</li>  
        <li data-kurum="Noter" data-detay="Vekalet sÃ¶zleÅŸmesi">Vekalet sÃ¶zleÅŸmesi</li>  
      </ul>  
    </div>  
    <div class="alt-baslik-kutu" tabindex="0" aria-expanded="false">  
      <span class="alt-baslik-ikon">ğŸ—ï¸</span>  
      YapÄ± Denetim  
      <span class="alt-kutu-arrow">&#9654;</span>  
    </div>  
    <div class="alt-kutu-icerik">  
      <ul>  
        <li data-kurum="YapÄ± Denetim" data-detay="YapÄ± denetim harcÄ±">YapÄ± denetim harcÄ±</li>  
        <li data-kurum="YapÄ± Denetim" data-detay="Fenni JÃ¼ri">Fenni Jeoloji</li>  
        <li data-kurum="YapÄ± Denetim" data-detay="Fenni harita/g">Fenni haritacÄ±</li>  
      </ul>  
    </div>  
    <div class="alt-baslik-kutu" tabindex="0" aria-expanded="false">  
      <span class="alt-baslik-ikon">ğŸŒ</span>  
      Zemin EtÃ¼dÃ¼  
      <span class="alt-kutu-arrow">&#9654;</span>  
    </div>  
    <div class="alt-kutu-icerik">  
      <ul>  
        <li data-kurum="Zemin EtÃ¼dÃ¼" data-detay="Zemin etÃ¼dÃ¼ raporu">Zemin etÃ¼dÃ¼ raporu</li>  
        <li data-kurum="Zemin EtÃ¼dÃ¼" data-detay="Zemin iyileÅŸtirme">Zemin iyileÅŸtirme</li>  
      </ul>  
    </div>  
    <div class="alt-baslik-kutu" tabindex="0" aria-expanded="false">  
      <span class="alt-baslik-ikon">ğŸ“</span>  
      Projeler  
      <span class="alt-kutu-arrow">&#9654;</span>  
    </div>  
    <div class="alt-kutu-icerik">  
      <ul>  
        <li data-kurum="Projeler" data-detay="Mimari">Mimari</li>  
        <li data-kurum="Projeler" data-detay="Statik">Statik</li>  
        <li data-kurum="Projeler" data-detay="Elektrik">Elektrik</li>  
        <li data-kurum="Projeler" data-detay="Tesisat">Tesisat</li>  
        <li data-kurum="Projeler" data-detay="HES">HES</li>  
        <li data-kurum="Projeler" data-detay="Akustik">Akustik</li>  
        <li data-kurum="Projeler" data-detay="AsansÃ¶r">AsansÃ¶r</li>  
      </ul>  
    </div>  
  </div>  
</div>

    <!-- YapÄ± RuhsatÄ± BÃ¶lÃ¼mÃ¼ -->  
    <div class="surec-section" id="tab-ruhsat">  
      <div class="bolum-baslik">YapÄ± RuhsatÄ±</div>  
      <button class="evrak-ekle-btn">Evrak Ekle</button>  
    </div>  

    <!-- Ãœretim BÃ¶lÃ¼mÃ¼ -->
    <div class="surec-section mb-4" id="tab-uretim">
      <div class="bolum-baslik">Ãœretim</div>
      <div class="uretim-tabs-row">
        <button id="btnKaba" class="uretim-tab-btn active"><span class="uretim-ikon">ğŸ§±</span> Kaba Ãœretim</button>
        <button id="btnInce" class="uretim-tab-btn"><span class="uretim-ikon">ğŸ¨</span> Ä°nce Ãœretim</button>
      </div>

      <!-- Kaba Ãœretim AdÄ±mlarÄ± -->
    <div class="uretim-kategori" id="kabaUretim" style="display:block;">
      <div class="uretim-steps-row w-100 mx-auto" style="max-width:980px;"></div>
    </div>
    <!-- Ä°nce Ãœretim AdÄ±mlarÄ± (boÅŸ ÅŸablon) -->
    <div class="uretim-kategori" id="inceUretim" style="display:none;">
      <div class="uretim-steps-row w-100 mx-auto" style="max-width:980px;justify-content:center;">
          <span style="font-family:'Varela Round', Arial,sans-serif;color:#7b8399;font-size:1.13rem;opacity:0.8;">Ä°nce Ã¼retim adÄ±mlarÄ± burada listelenecekâ€¦</span>
      </div>
    </div>
  </div>


    <!-- Dinamik Modal -->
<div class="modal fade" id="modalUretim" tabindex="-1" aria-labelledby="modalUretimLabel" aria-hidden="true">  
  <div class="modal-dialog modal-xl modal-dialog-scrollable">  
    <div class="modal-content" style="border-radius:19px;">  
      <div class="modal-header bg-primary text-white">  
        <h5 class="modal-title" id="modalUretimLabel">  
          <span id="modalBaslikIkon"></span>  
          <span id="modalBaslikText"></span>  
        </h5>  
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>  
      </div>  
      <div class="modal-body pb-1">  
        <div id="modalContentGenel"></div>  
      </div>  
    </div>  
  </div>  
</div>

<div class="modal fade" id="evrakModal" tabindex="-1" aria-labelledby="evrakModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="evrakModalLabel">Evrak GÃ¶rÃ¼ntÃ¼le</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
      </div>
      <div class="modal-body" id="evrakModalBody" style="min-height:350px;">
        <!-- Ä°Ã§erik buraya yÃ¼klenecek -->
      </div>
    </div>
  </div>
</div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  
  <script type="module">
    import { showWarningMessage } from '/js/showMessage.js';

    const projectNameString = document.getElementById("projectName");
    const quatationButton = document.getElementById("quatation-button"); 
    const graphsButton = document.getElementById("graphs-button");
    const soldButton = document.getElementById("sold-button");
    const buttonHome = document.getElementById("buttonHome");
    const imageInput = document.getElementById('modalImageInput');
    const previewArea = document.getElementById('modalPreviewArea');
    const btn = document.getElementById('modalToPdfBtn');
    let imgDataUrl = null;
    const btnKaba = document.getElementById('btnKaba');
    const btnInce = document.getElementById('btnInce');
    const kabaUretim = document.getElementById('kabaUretim');
    const inceUretim = document.getElementById('inceUretim');

    let userId = null;
    let projectName = null;
    let building = null;
    let floorsDataFromDb = null;
    

    // DOM yÃ¼klendiÄŸinde iÅŸlem baÅŸlat  
    document.addEventListener("DOMContentLoaded", () => { 

        window.user = {{#if user}}
        { "email": "{{user.email}}", "role": "{{user.role}}", "userId": "{{user.id}}", "project": {{{json project}}} }
        {{else}}
            { "role": "{{role}}" }
        {{/if}};

        userId = window.user.userId;
        const projectNameDb = window.user.project.projectName;
        projectName = projectNameDb;
        if(projectName){
            const projectNameText = projectNameDb.toUpperCase();
            projectNameString.textContent = projectNameText;
        }
        if(userId){
            loginButton.style.display = "block";
        } else{
            loginButton.style.display = "none";
        }

        const urlParams = new URLSearchParams(window.location.search);  
        const cameFrom = urlParams.get('from');  
        if (cameFrom) {  
            fromControl = true;
            regulationButtonMobileArea.style.display = "none";
            regulationButtonArea.style.display = "none";
        }
 
        // Ä°lk aÃ§Ä±lÄ±ÅŸta Kaba Ãœretim aÃ§Ä±k baÅŸlasÄ±n
        toggleTab(true);

        // Buton tÄ±klama
        btnKaba.addEventListener('click', function() { toggleTab(true); });
        btnInce.addEventListener('click', function() { toggleTab(false); });
    });


    // Sekmeler arasÄ±nda geÃ§iÅŸ (Kaba & Ä°nce Ãœretim)
    function toggleTab(showKaba) {
      if (showKaba) {
        kabaUretim.style.display = 'block';
        inceUretim.style.display = 'none';
        btnKaba.classList.add('active');
        btnInce.classList.remove('active');
      } else {
        kabaUretim.style.display = 'none';
        inceUretim.style.display = 'block';
        btnInce.classList.add('active');
        btnKaba.classList.remove('active');
      }
    }

    // (EÄŸer birden fazla flow sekmesi varsa kullan)
    // Flow tab switch
    document.querySelectorAll('.flow-step-btn').forEach(function(tab){
      tab.addEventListener('click', function(){
          document.querySelectorAll('.flow-step-btn').forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          const sectionId = 'tab-' + this.getAttribute('data-tab');
          document.querySelectorAll('.surec-section').forEach(sec => sec.classList.remove('active'));
          document.getElementById(sectionId).classList.add('active');
      });
    });

    // ============ Accordion ==================
document.querySelectorAll('.alt-baslik-kutu').forEach(function(header) {
  header.addEventListener('click', function(){
    // KapatÄ±lacak iÃ§erik, baÅŸlÄ±ÄŸÄ±n hemen sonraki kardeÅŸidir:
    const content = header.nextElementSibling;

    const isOpen = header.getAttribute('aria-expanded') === 'true';

    // TÃ¼m baÅŸlÄ±k ve iÃ§erikleri kapat
    document.querySelectorAll('.alt-baslik-kutu').forEach(h => {
      h.setAttribute('aria-expanded', 'false');
      h.querySelector('.alt-kutu-arrow').innerHTML = "&#9654;"; // SaÄŸ ok
    });
    document.querySelectorAll('.alt-kutu-icerik').forEach(c => c.style.display = 'none');

    // EÄŸer tÄ±klanan zaten aÃ§Ä±ksa KAPALI bÄ±rak, deÄŸilse AÃ‡
    if(!isOpen){
      header.setAttribute('aria-expanded','true');
      content.style.display = 'block';
      header.querySelector('.alt-kutu-arrow').innerHTML = "&#9660;"; // AÅŸaÄŸÄ± ok (isteÄŸe baÄŸlÄ±)
    }
  });

  // Klavye ile de Ã§alÄ±ÅŸsÄ±n:
  header.addEventListener('keydown', function(e){
    if(e.key === "Enter" || e.key === " ") { 
      e.preventDefault(); header.click();
    }
  });
});

// Sayfa ilk yÃ¼klendiÄŸinde tÃ¼m iÃ§erikler kapalÄ± olsun:
document.querySelectorAll('.alt-kutu-icerik').forEach(c => c.style.display = 'none');


let aktifEvrakKurum = null, aktifEvrakDetay = null, aktifEvrakKey = null;
// ============ Alt Liste <li> Click - Modal ==================
document.querySelectorAll('.alt-kutu-icerik li').forEach(function(item) {
  item.style.cursor = 'pointer';
  item.addEventListener('click', function() {
    aktifAdimId = null; // Kaba Ãœretimden ayÄ±rt!
    aktifAltKalem = null;
    aktifEvrakKurum = this.getAttribute('data-kurum') || '';
    aktifEvrakDetay = this.getAttribute('data-detay') || this.innerText.trim();
    aktifEvrakKey = `evrak:${aktifEvrakKurum}:${aktifEvrakDetay}`;

    document.getElementById('modalBaslikIkon').textContent = ikonBul(aktifEvrakKurum);
    document.getElementById('modalBaslikText').textContent = aktifEvrakKurum + ' - ' + aktifEvrakDetay;

    showOdemeEvrakForm(false, true); // (isRadyal=false, isEvrakIsleri=true)
    bootstrap.Modal.getOrCreateInstance(document.getElementById('modalUretim')).show();
  });
});
function ikonBul(kurum) {
  switch (kurum) {
    case 'Belediye': return 'ğŸ›ï¸';
    case 'Noter': return 'ğŸ–‹ï¸';
    case 'YapÄ± Denetim': return 'ğŸ—ï¸';
    case 'Zemin EtÃ¼dÃ¼': return 'ğŸŒ';
    case 'Projeler': return 'ğŸ“';
    default: return '';
  }
}

    // Kaba Ãœretim AdÄ±mlarÄ± - TAM LÄ°STE
const URETIM_ADIMLARI = [
  { id: 'santiyeKurma',  ad: "Åantiye kurma",                     icon: "fa-hard-hat"         },
  { id: 'temelKazma',    ad: "Temel kazma",                       icon: "fa-mountain-sun"     },
  { id: 'groBeton',      ad: "Gro beton",                         icon: "fa-bricks"           },
  { id: 'radyalTemel',   ad: "Radyal Temel",                      icon: "fa-cube"             },
  { id: 'perdeBetonu',   ad: "Perde betonu",                      icon: "fa-border-all"       },
  { id: 'temelIzolasyon',ad: "Temel izolasyonu",                  icon: "fa-shield-halved"    },
  { id: 'dolgu',         ad: "Dolgu",                             icon: "fa-road"             },
  { id: 'subasman',      ad: "Subasman",                          icon: "fa-square-poll-horizontal"},
  { id: 'zeminBetonu',   ad: "Zemin betonu",                      icon: "fa-th-large"         },
  { id: 'katBetonlari',  ad: "1-2-3-4. kat betonlarÄ±",            icon: "fa-layer-group"      },
  { id: 'kapamaBetonu', ad: "Kapama betonu",                      icon: "fa-layer-minus"      },
  { id: 'catiUygulama',  ad: "Ã‡atÄ± uygulamalarÄ±",                 icon: "fa-house-chimney"    },
  { id: 'duvarOrme',     ad: "Duvar Ã¶rme",                        icon: "fa-grip-lines-vertical"},
  { id: 'sap',            ad: "ÅAP",                              icon: "fa-fill"    }
];

const RADYAL_ALTKALEM = [
  { id:"demir",   ad:"Demir",   icon:"fa-dna" },
  { id:"beton",   ad:"Beton",   icon:"fa-mountain" },
  { id:"tel",     ad:"Tel",     icon:"fa-wave-square" },
  { id:"civi",    ad:"Ã‡ivi",    icon:"fa-thumbtack" },
  { id:"diger",   ad:"DiÄŸer",   icon:"fa-ellipsis" }
];
const TEMEL_IZALASYONU = [
  { id:"su_tutucu_bant",    ad:"Su Tutucu Bant",    icon:"fa-tape" },                   // veya "fa-tape", "fa-grip-lines"
  { id:"mebran",            ad:"Mebran",            icon:"fa-layer-group" },           // katman mantÄ±ÄŸÄ± iÃ§in
  { id:"likit_mebran",      ad:"Likit Mebran",      icon:"fa-tint" },                  // sÄ±vÄ±/sembol iÃ§in
  { id:"drenaj_levhasi",    ad:"Drenaj LevhasÄ±",    icon:"fa-water" },                 // su/drenaj imajÄ± iÃ§in
  { id:"diger",             ad:"DiÄŸer",             icon:"fa-ellipsis" }
];
const SU_BASMAN = [
  { id:"celik_hasir",       ad:"Ã‡elik HasÄ±r",       icon:"fa-border-all" },                   
  { id:"beton",             ad:"Beton",             icon:"fa-mountain" },
  { id:"diger",             ad:"DiÄŸer",             icon:"fa-ellipsis" }
];
const ZEMIN_BETONU = [
  { id:"demir",   ad:"Demir",   icon:"fa-dna" },
  { id:"beton",   ad:"Beton",   icon:"fa-mountain" },
  { id:"tel",     ad:"Tel",     icon:"fa-wave-square" },
  { id:"civi",    ad:"Ã‡ivi",    icon:"fa-thumbtack" },
  { id:"diger",   ad:"DiÄŸer",   icon:"fa-ellipsis" }
];
const KAT_BETONLARI = [
  { id:"demir",   ad:"Demir",   icon:"fa-dna" },
  { id:"beton",   ad:"Beton",   icon:"fa-mountain" },
  { id:"tel",     ad:"Tel",     icon:"fa-wave-square" },
  { id:"civi",    ad:"Ã‡ivi",    icon:"fa-thumbtack" },
  { id:"diger",   ad:"DiÄŸer",   icon:"fa-ellipsis" }
];
const CATI = [
  { id:"kereste",             ad:"Kereste",             icon:"fa-tree" },
  { id:"osb",                 ad:"OSB",                 icon:"fa-layer-group" },
  { id:"cati_izalasyonu",     ad:"Ã‡atÄ± Ä°zalasyonu",     icon:"fa-fill-drip" },
  { id:"kiremit",             ad:"Kiremit",             icon:"fa-th" },
  { id:"diger",               ad:"DiÄŸer",               icon:"fa-ellipsis" }
];
const KAPAMA_BETONU = [
  { id:"demir",   ad:"Demir",   icon:"fa-dna" },
  { id:"beton",   ad:"Beton",   icon:"fa-mountain" },
  { id:"tel",     ad:"Tel",     icon:"fa-wave-square" },
  { id:"civi",    ad:"Ã‡ivi",    icon:"fa-thumbtack" },
  { id:"diger",   ad:"DiÄŸer",   icon:"fa-ellipsis" }
];
const SAP = [
  { id:"kum",       ad:"Kum",     icon:"fa-mound" },
  { id:"cimento",   ad:"Ã‡imento", icon:"fa-cube" },
  { id:"diger",     ad:"DiÄŸer",   icon:"fa-ellipsis" }
];
const DUVAR_ORME = [
  { id:"cimento",   ad:"Ã‡imento", icon:"fa-cube" },
  { id:"duvar_blogu", ad:"Duvar BloÄŸu", icon:"fa-th-large" },   // veya fa-cubes (Ã¶rÃ¼lÃ¼ blok iÃ§in uygun)
  { id:"kirec",       ad:"KireÃ§",       icon:"fa-flask" },      // laboratuvar/doÄŸal malzeme takibi iÃ§in, yoksa fa-snowflake (beyaz toz temsili)
  { id:"kum_cakil",   ad:"Kum-Ã‡akÄ±l",   icon:"fa-mound" },      // kum/Ã§akÄ±l yÄ±ÄŸÄ±nÄ± iÃ§in modern ve uygun!
  { id:"diger",   ad:"DiÄŸer",   icon:"fa-ellipsis" }
];

// Her kombinasyonda ayrÄ± veri
const odemeData = {};
const evrakData = {};

let aktifAdimId = null, aktifAltKalem = null;

// AdÄ±m butonlarÄ±nÄ± oluÅŸtur
const stepsRowEl = document.querySelector('.uretim-steps-row');
stepsRowEl.innerHTML = '';
URETIM_ADIMLARI.forEach((adim, idx) => {
  const btn = document.createElement('button');
  btn.type = "button";
  btn.className = "uretim-step-btn btn btn-outline-primary";
  btn.setAttribute('data-adimid', adim.id);
  btn.innerHTML = `<i class="fa-solid ${adim.icon} me-1"></i>${adim.ad}`;
  stepsRowEl.appendChild(btn);

  // EÄŸer son adÄ±m deÄŸilse ok ekle
  if (idx < URETIM_ADIMLARI.length - 1) {
    const ok = document.createElement('span');
    ok.className = "uretim-step-ok";
    ok.innerHTML = `<svg class="uretim-ok-svg" viewBox="0 0 34 24"><polyline points="2,12 28,12"/><polyline points="22,6 28,12 22,18"/></svg>`;
    stepsRowEl.appendChild(ok);
  }
});

// --- Modal: AdÄ±ma tÄ±klayÄ±nca aÃ§Ä±lÄ±r ---
document.querySelectorAll('.uretim-step-btn').forEach(btn => {  
  btn.addEventListener('click', function(){  
    aktifAdimId = btn.getAttribute('data-adimid');  
    aktifAltKalem = null;  
    const adim = URETIM_ADIMLARI.find(a=>a.id===aktifAdimId);  
    document.getElementById('modalBaslikIkon').innerHTML = `<i class="fa-solid ${adim.icon} me-1"></i>`;  
    document.getElementById('modalBaslikText').textContent = adim.ad;  
    if(aktifAdimId==='radyalTemel'){  
      showRadyalKalemler();  
    } else if(aktifAdimId==='perdeBetonu'){
      showPerdeKalemler();
    } else if(aktifAdimId==='temelIzolasyon'){
      showTemelIzalasyonuKalemler();
    } else if(aktifAdimId==='subasman'){
      showSuBasmanKalemler();
    } else if(aktifAdimId==='zeminBetonu'){
      showZeminBetonuKalemler();
    } else if(aktifAdimId==='katBetonlari'){
      showKatBetonlariKalemler();
    } else if(aktifAdimId==='catiUygulama'){
      showCatiKalemler();
    } else if(aktifAdimId==='kapamaBetonu'){
      showKapamaBetonuKalemler();
    } else if(aktifAdimId==='sap'){
      showSapKalemler();
    } else if(aktifAdimId==='duvarOrme'){
      showDuvarOrmeKalemler();
    }
    else {  
      showOdemeEvrakForm();  
    }  
    bootstrap.Modal.getOrCreateInstance(document.getElementById('modalUretim')).show();  
  });  
});  

// 1. Radyal Temel alt kalemlerini butonla gÃ¶ster:
function showRadyalKalemler(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">Radyal Temel - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="radyalKalemBtnGrup">${  
        RADYAL_ALTKALEM.map(kal =>  
          `<button type="button" class="btn btn-outline-primary radyal-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="radyalAltKalemForm"></div>`;  

  document.querySelectorAll('.radyal-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "Radyal Temel - "+ RADYAL_ALTKALEM.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showRadyalKalemler);
    }  
  });  
}
function showPerdeKalemler(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">Perde Beton - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="perdeKalemBtnGrup">${  
        RADYAL_ALTKALEM.map(kal =>  
          `<button type="button" class="btn btn-outline-primary perde-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="perdeAltKalemForm"></div>`;  

  document.querySelectorAll('.perde-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "Perde Beton - "+ RADYAL_ALTKALEM.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showPerdeKalemler);
    }  
  });  
}
function showTemelIzalasyonuKalemler(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">Temel Ä°zalasyonu - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="temelIzalasyonKalemBtnGrup">${  
        TEMEL_IZALASYONU.map(kal =>  
          `<button type="button" class="btn btn-outline-primary temel_izalasyon-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="temelIzalasyonAltKalemForm"></div>`;  

  document.querySelectorAll('.temel_izalasyon-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "Temel Ä°zalasyonu - "+ TEMEL_IZALASYONU.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showTemelIzalasyonuKalemler);
    }  
  });  
}
function showSuBasmanKalemler(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">Subasman - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="subasmanKalemBtnGrup">${  
        SU_BASMAN.map(kal =>  
          `<button type="button" class="btn btn-outline-primary subasman-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="subasmanAltKalemForm"></div>`;  

  document.querySelectorAll('.subasman-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "Subasman - "+ SU_BASMAN.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showSuBasmanKalemler);
    }  
  });  
}
function showZeminBetonuKalemler(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">Zemin Betonu - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="zeminBetonuKalemBtnGrup">${  
        ZEMIN_BETONU.map(kal =>  
          `<button type="button" class="btn btn-outline-primary zemin-betonu-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="zeminBetonuAltKalemForm"></div>`;  

  document.querySelectorAll('.zemin-betonu-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "Zemin Betonu - "+ ZEMIN_BETONU.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showZeminBetonuKalemler);
    }  
  });  
}
function showKatBetonlariKalemler(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">Kat BetonlarÄ± - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="katBetonlariKalemBtnGrup">${  
        KAT_BETONLARI.map(kal =>  
          `<button type="button" class="btn btn-outline-primary kat-betonlari-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="katBetonlariAltKalemForm"></div>`;  

  document.querySelectorAll('.kat-betonlari-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "Kat BetonlarÄ± - "+ KAT_BETONLARI.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showKatBetonlariKalemler);
    }  
  });  
}
function showCatiKalemler(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">Ã‡atÄ± - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="catiKalemBtnGrup">${  
        CATI.map(kal =>  
          `<button type="button" class="btn btn-outline-primary cati-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="catiAltKalemForm"></div>`;  

  document.querySelectorAll('.cati-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "Ã‡atÄ± - "+ CATI.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showCatiKalemler);
    }  
  });  
}
function showKapamaBetonuKalemler(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">Kapama Betonu - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="kapamaBetonuKalemBtnGrup">${  
        KAPAMA_BETONU.map(kal =>  
          `<button type="button" class="btn btn-outline-primary kapama-betonu-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="kapamaBetonuAltKalemForm"></div>`;  

  document.querySelectorAll('.kapama-betonu-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "Kapama Betonu - "+ KAPAMA_BETONU.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showKapamaBetonuKalemler);
    }  
  });  
}
function showSapKalemler(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">ÅAP - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="sapKalemBtnGrup">${  
        SAP.map(kal =>  
          `<button type="button" class="btn btn-outline-primary sap-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="sapAltKalemForm"></div>`;  

  document.querySelectorAll('.sap-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "ÅAP - "+ SAP.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showSapKalemler);
    }  
  });  
}
function showDuvarOrmeKalemler(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">Duvar Ã–rme - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="duvarOrmeKalemBtnGrup">${  
        DUVAR_ORME.map(kal =>  
          `<button type="button" class="btn btn-outline-primary duvar-orme-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="duvarOrmeAltKalemForm"></div>`;  

  document.querySelectorAll('.duvar-orme-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "Duvar Ã–rme - "+ DUVAR_ORME.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showDuvarOrmeKalemler);
    }  
  });  
}


const INCE_URETIM_ADIMLARI = [
  { id: 'zeminUygulamalari',  ad: "Zemin UygulamalarÄ±",  icon: "fa-grip-lines" }, // veya "fa-border-none", "fa-th-large"
  { id: 'icCephe',            ad: "Ä°Ã§ Cephe",            icon: "fa-home" }, // "fa-paint-roller" da olabilir
  { id: 'islakMekanlar',      ad: "Islak Mekanlar",      icon: "fa-shower" },
  { id: 'mutfak',             ad: "Mutfak",              icon: "fa-utensils" }, // veya "fa-kitchen-set" FA6+
  { id: 'pimapen',            ad: "Pimapen",             icon: "fa-window-maximize" }, // pencere iÃ§in
  { id: 'kapilar',            ad: "KapÄ±lar",             icon: "fa-door-open" },
  { id: 'korkuluklar',        ad: "Korkuluklar",         icon: "fa-grip-vertical" }, // veya "fa-archway" veya "fa-bars"
  { id: 'disCephe',           ad: "DÄ±ÅŸ Cephe",           icon: "fa-city" }, // veya "fa-building", "fa-warehouse"
  { id: 'tavan',              ad: "Tavan",               icon: "fa-border-top-left" }, // En uygun FA6+, FA5 yoksa "fa-grip-lines"
  { id: 'elektrikTesisat',    ad: "Elektrik Tesisat",    icon: "fa-bolt" }, // yÄ±ldÄ±rÄ±m
  { id: 'sihhiTesisat',       ad: "SÄ±hhi Tesisat",       icon: "fa-faucet" }, // musluk (FA6+), FA5'te "fa-tint"
  { id: 'dogalgaz',           ad: "DoÄŸalgaz",            icon: "fa-fire-flame-simple" }, // alev FA6+, FA5 "fa-fire"
  { id: 'asansorKurulumu',    ad: "AsansÃ¶r Kurulumu",    icon: "fa-elevator" }, // FA6+; FA5'te "fa-arrow-up", "fa-arrow-down"
  { id: 'iklimlendirme',      ad: "Ä°klimlendirme",       icon: "fa-fan" }, // veya "fa-wind", "fa-snowflake" (klima/Ä±sÄ±tma)
  { id: 'peyzaj',             ad: "Peyzaj",              icon: "fa-seedling" } // bitki, Ã§im
];

const ZEMIN_UYGULAMALARI = [
  { id:"seramik",     ad:"Seramik",        icon:"fa-border-none" },  // karo/seramik iÃ§in en uygun
  { id:"parke",       ad:"Parke",          icon:"fa-grip-lines" },   // parke veya zemin dÃ¶ÅŸeme imajÄ±
  { id:"mermer",      ad:"Mermer",         icon:"fa-gem" },          // kristal, deÄŸerli taÅŸ - alternatifi yoksa fa-cube
  { id:"zeminBoyasi", ad:"Zemin BoyasÄ±",   icon:"fa-paint-roller" }, // FA6+, yoksa "fa-brush" veya "fa-tint"
  { id:"epoksi",      ad:"Epoksi",         icon:"fa-flask" },        // sÄ±vÄ±/kimyasal temsili iÃ§in
  { id:"diger",       ad:"DiÄŸer",           icon:"fa-ellipsis" }
];

const SIHHI_TESISAT = [
  { id:"pisSu",     ad:"Pis Su",      icon:"fa-toilet" },         // Pis su/atÄ±ksu iÃ§in 'tuvalet' temasÄ± uygun
  { id:"temizSu",   ad:"Temiz Su",    icon:"fa-faucet" },         // Temiz su/musluk iÃ§in en uygun
  { id:"isitma",    ad:"IsÄ±tma",      icon:"fa-temperature-high" },// IsÄ±tma (radyatÃ¶r, sÄ±caklÄ±k gÃ¶stergesi)
  { id:"diger",     ad:"DiÄŸer",       icon:"fa-ellipsis" }
];

const IC_CEPHE = [
  { id:"korKasa",       ad:"KÃ¶r Kasa",         icon:"fa-door-closed" },      // KapÄ± kasasÄ±/kasa iÃ§in
  { id:"kosebent",      ad:"KÃ¶ÅŸebent",         icon:"fa-ruler-combined" },   // Profil/Mil/KÃ¶ÅŸe iÃ§in uygun
  { id:"betonAstari",   ad:"Beton AstarÄ±",     icon:"fa-fill-drip" },        // SÄ±vÄ±/astar iÃ§in
  { id:"alci",          ad:"AlÃ§Ä±",             icon:"fa-snowflake" },        // Toz/beyaz/pudra iÃ§in bu sÄ±k tercih edilir
  { id:"cimento",       ad:"Ã‡imento",          icon:"fa-cube" },             // Malzeme/blok gibi
  { id:"kum",           ad:"Kum",              icon:"fa-mound" },            // Kum yÄ±ÄŸÄ±nÄ±
  { id:"hazirSivaIc",   ad:"HazÄ±r SÄ±va Ä°Ã§",    icon:"fa-trowel" },           // FA6+ (SÄ±va aleti), yoksa "fa-layer-group"
  { id:"icCepheBoyasi", ad:"Ä°Ã§ Cephe BoyasÄ±",  icon:"fa-paint-roller" },     // FA6+, yoksa "fa-paint-brush"
  { id:"boyaAstari",    ad:"Boya AstarÄ±",      icon:"fa-brush" },            // FÄ±rÃ§a/astar iÃ§in
  { id:"diger",         ad:"DiÄŸer",            icon:"fa-ellipsis" }
];
const TAVAN = [
  { id:"stropiyer", ad:"Stropiyer", icon:"fa-wave-square" },      // Dalga/kÃ¶pÃ¼k yapÄ±sÄ± iÃ§in
  { id:"alcipan",   ad:"AlÃ§Ä±pan",   icon:"fa-layer-group" },      // Tabaka/panel/Laminar yapÄ± iÃ§in
  { id:"karolem",   ad:"Karolem",   icon:"fa-th-large" },         // Kare tavan paneli/dÃ¶ÅŸeme iÃ§in
  { id:"diger",     ad:"DiÄŸer",     icon:"fa-ellipsis" }
];
const PIMAPEN = [
  { id:"pencereler",    ad:"Pencereler",      icon:"fa-window-maximize" },  // Pencere iÃ§in
  { id:"zeminDograma",  ad:"Zemin DoÄŸrama",   icon:"fa-vector-square" },    // Zemin/profil/doÄŸrama iÃ§in
  { id:"diger",         ad:"DiÄŸer",           icon:"fa-ellipsis" }
];
const KAPILAR = [
  { id:"odaKapilari",   ad:"Oda KapÄ±larÄ±",     icon:"fa-door-open" },      // Ä°Ã§ kapÄ± iÃ§in en uygunu
  { id:"celikKapilar",  ad:"Ã‡elik KapÄ±lar",    icon:"fa-shield-alt" },     // GÃ¼venlik/Ã§elik kapÄ± iÃ§in kalkan (FA6+'da 'fa-shield-halved' da olabilir)
  { id:"diger",         ad:"DiÄŸer",            icon:"fa-ellipsis" }
];
const PEYZAJ = [
  { id:"bahceDuvari",   ad:"BahÃ§e DuvarÄ±",     icon:"fa-border-style" },     // Duvar/Ã§it gÃ¶rÃ¼nÃ¼mÃ¼ iÃ§in
  { id:"bitkilendirme", ad:"Bitkilendirme",    icon:"fa-seedling" },         // Bitki/yeÅŸillik iÃ§in
  { id:"perforje",      ad:"Perforje",         icon:"fa-grip-lines-vertical" }, // Demir parmaklÄ±k/ferforje iÃ§in
  { id:"diger",         ad:"DiÄŸer",            icon:"fa-ellipsis" }
];
const MUTFAK = [
  { id:"tezgah",           ad:"Tezgah",           icon:"fa-grip-horizontal" },    // Tezgah, yÃ¼zey iÃ§in ideal
  { id:"mutfakEvye",       ad:"Mutfak Evye",      icon:"fa-sink" },               // Evye/Lavabo iÃ§in (FA6+)
  { id:"mutfakDolabi",     ad:"Mutfak DolabÄ±",    icon:"fa-box-archive" },     // Dolap iÃ§in (FA6+); yoksa fa-box-archive
  { id:"mutfakBataryasi",  ad:"Mutfak BataryasÄ±", icon:"fa-faucet" },             // Musluk/batarya iÃ§in (FA6+); yoksa fa-tint
  { id:"ankastre",         ad:"Ankastre",         icon:"FA6+" },               // FÄ±rÄ±n/ankastre iÃ§in (FA6+)
  { id:"diger",            ad:"DiÄŸer",            icon:"fa-ellipsis" }
];
const ISLAK_MEKANLAR = [
  { id:"zeminYalitimi",    ad:"Zemin YalÄ±tÄ±mÄ±",      icon:"fa-water" },             // Su yalÄ±tÄ±mÄ± iÃ§in
  { id:"seramikFayans",    ad:"Seramik Fayans",      icon:"fa-th" },                // Fayans/seramik karo iÃ§in (kutu ÅŸeklinde)
  { id:"klozetler",        ad:"Klozetler",           icon:"fa-toilet" },            // Klozet iÃ§in
  { id:"lavabolar",        ad:"Lavabolar",           icon:"fa-sink" },              // Lavabo iÃ§in (FA6+), yoksa fa-tint
  { id:"banyoDolabi",      ad:"Banyo DolabÄ±",        icon:"fa-box-archive" },    // Dolap iÃ§in (FA6+), yoksa fa-box-archive veya fa-box
  { id:"dusTeknesi",       ad:"DuÅŸ Teknesi",         icon:"fa-shower" },            // DuÅŸ iÃ§in
  { id:"banyoBataryasi",   ad:"Banyo BataryasÄ±",     icon:"fa-faucet" },            // Batarya iÃ§in, yoksa fa-tint
  { id:"lavaboBataryasi",  ad:"Lavabo BataryasÄ±",    icon:"fa-faucet-drip" },       // FA6+; yoksa fa-faucet
  { id:"diger",            ad:"DiÄŸer",               icon:"fa-ellipsis" }
];
const IKLIMLENDIRME = [
  { id:"kombi",         ad:"Kombi",           icon:"fa-fire" },          // IsÄ±/kombi iÃ§in en geneli
  { id:"kombiDolabi",   ad:"Kombi DolabÄ±",    icon:"fa-box-archive" },// Dolap iÃ§in (FA6+), yoksa fa-box
  { id:"klima",         ad:"Klima",           icon:"fa-wind" },          // SoÄŸutma/iklimlendirme iÃ§in uygun
  { id:"diger",         ad:"DiÄŸer",           icon:"fa-ellipsis" }
];
const DIS_CEPHE = [
  { id:"hazirSivaDis",   ad:"HazÄ±r SÄ±va DÄ±ÅŸ",    icon:"fa-fill-drip" },      // SÄ±va/ÅŸantiye iÃ§in
  { id:"cimento",        ad:"Ã‡imento",           icon:"fa-cube" },           // Ã‡imento paketi/kÃ¼p gibi
  { id:"kum",            ad:"Kum",               icon:"fa-mountain" },       // Kum/taÅŸ yÄ±ÄŸÄ±nÄ± iÃ§in (veya fa-archway)
  { id:"karbonluEps",    ad:"Karbonlu Eps",      icon:"fa-dice-d6" },        // KÃ¶pÃ¼k, blok benzeri malzemeler iÃ§in
  { id:"xps",            ad:"XPS",               icon:"fa-layer-group" },    // Tabaka/panel tipleri iÃ§in
  { id:"tasYunu",        ad:"TaÅŸ YÃ¼nÃ¼",          icon:"fa-feather-alt" },    // HafifliÄŸi yansÄ±tmak iÃ§in (veya fa-layer-group)
  { id:"disCepheBoyasi", ad:"DÄ±ÅŸ cephe BoyasÄ±",  icon:"fa-paint-roller" },  // DÄ±ÅŸ cephe boyasÄ± iÃ§in
  { id:"boyaAstari",     ad:"Boya AstarÄ±",       icon:"fa-brush" },
  { id:"korKasa",       ad:"KÃ¶r Kasa",           icon:"fa-door-closed" },
  { id:"kosebent",      ad:"KÃ¶ÅŸebent",           icon:"fa-ruler-combined" },
  { id:"betonAstari",   ad:"Beton AstarÄ±",       icon:"fa-fill-drip" },
  { id:"alci",          ad:"AlÃ§Ä±",               icon:"fa-snowflake" },
  { id:"diger",         ad:"DiÄŸer",              icon:"fa-ellipsis" }
];

// Ä°nce Ãœretim adÄ±mlarÄ±nÄ± buton olarak oluÅŸtur
const inceStepsRowEl = document.querySelector('#inceUretim .uretim-steps-row');
if(inceStepsRowEl){
  inceStepsRowEl.innerHTML = '';
  INCE_URETIM_ADIMLARI.forEach((adim, idx) => {
    const btn = document.createElement('button');
    btn.type = "button";
    btn.className = "uretim-step-btn btn btn-outline-secondary"; // Rengi ayÄ±r edebilirsin
    btn.setAttribute('data-adimid', adim.id);
    btn.innerHTML = `<i class="fa-solid ${adim.icon} me-1"></i>${adim.ad}`;
    inceStepsRowEl.appendChild(btn);

    // Ok ekle
    if (idx < INCE_URETIM_ADIMLARI.length - 1) {
      const ok = document.createElement('span');
      ok.className = "uretim-step-ok";
      ok.innerHTML = `<svg class="uretim-ok-svg" viewBox="0 0 34 24"><polyline points="2,12 28,12"/><polyline points="22,6 28,12 22,18"/></svg>`;
      inceStepsRowEl.appendChild(ok);
    }
  });

  // Event listener ekle
  inceStepsRowEl.querySelectorAll('.uretim-step-btn').forEach(btn => {
    btn.addEventListener('click', function(){
      aktifAdimId = btn.getAttribute('data-adimid');
      aktifAltKalem = null;
      const adim = INCE_URETIM_ADIMLARI.find(a=>a.id === aktifAdimId);
      document.getElementById('modalBaslikIkon').innerHTML = `<i class="fa-solid ${adim.icon} me-1"></i>`;
      document.getElementById('modalBaslikText').textContent = adim.ad;
      if (aktifAdimId === 'zeminUygulamalari') {
        showZeminUygulamalari();
      } else if(aktifAdimId === 'sihhiTesisat'){
        showSihhiTesisat();
      } else if(aktifAdimId === 'icCephe'){
        showIcCephe();
      } else if(aktifAdimId === 'tavan'){
        showTavan();
      } else if(aktifAdimId === 'pimapen'){
        showPimapen();
      } else if(aktifAdimId === 'kapilar'){
        showKapilar();
      } else if(aktifAdimId === 'peyzaj'){
        showPeyzaj();
      } else if(aktifAdimId === 'mutfak'){
        showMutfak();
      } else if(aktifAdimId === 'islakMekanlar'){
        showIslakMekanlar();
      } else if(aktifAdimId === 'iklimlendirme'){
        showIklimlendirme();
      } else if(aktifAdimId === 'disCephe'){
        showDisCephe();
      }
      //showOdemeEvrakForm();
      bootstrap.Modal.getOrCreateInstance(document.getElementById('modalUretim')).show();
    });
  });
}

function showZeminUygulamalari(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">Zemin UygulamalarÄ± - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="zeminUygulamalariBtnGrup">${  
        ZEMIN_UYGULAMALARI.map(kal =>  
          `<button type="button" class="btn btn-outline-primary zemin-uygulamalari-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="zeminUygulamalariAltKalemForm"></div>`;  

  document.querySelectorAll('.zemin-uygulamalari-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "Zemin UygulamalarÄ± - "+ ZEMIN_UYGULAMALARI.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showZeminUygulamalari);
    }  
  });  
}
function showSihhiTesisat(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">SÄ±hhi Tesisat - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="sihhiTesisatBtnGrup">${  
        SIHHI_TESISAT.map(kal =>  
          `<button type="button" class="btn btn-outline-primary sihhi-tesisat-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="sihhiTesisatAltKalemForm"></div>`;  

  document.querySelectorAll('.sihhi-tesisat-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "SÄ±hhi Tesisat - "+ SIHHI_TESISAT.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showSihhiTesisat);
    }  
  });  
}
function showIcCephe(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">Ä°Ã§ Cephe - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="icCepheBtnGrup">${  
        IC_CEPHE.map(kal =>  
          `<button type="button" class="btn btn-outline-primary ic-cephe-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="icCepheAltKalemForm"></div>`;  

  document.querySelectorAll('.ic-cephe-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "Ä°Ã§ Cephe - "+ IC_CEPHE.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showIcCephe);
    }  
  });  
}
function showTavan(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">Tavan - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="tavanBtnGrup">${  
        TAVAN.map(kal =>  
          `<button type="button" class="btn btn-outline-primary tavan-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="tavanAltKalemForm"></div>`;  

  document.querySelectorAll('.tavan-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "Tavan - "+ TAVAN.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showTavan);
    }  
  });  
}
function showPimapen(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">Pimapen - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="pimapenBtnGrup">${  
        PIMAPEN.map(kal =>  
          `<button type="button" class="btn btn-outline-primary pimapen-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="pimapenAltKalemForm"></div>`;  

  document.querySelectorAll('.pimapen-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "Pimapen - "+ PIMAPEN.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showPimapen);
    }  
  });  
}
function showKapilar(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">KapÄ±lar - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="kapilarBtnGrup">${  
        KAPILAR.map(kal =>  
          `<button type="button" class="btn btn-outline-primary kapilar-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="kapilarAltKalemForm"></div>`;  

  document.querySelectorAll('.kapilar-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "KapÄ±lar - "+ KAPILAR.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showKapilar);
    }  
  });  
}
function showPeyzaj(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">Peyzaj - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="peyzajBtnGrup">${  
        PEYZAJ.map(kal =>  
          `<button type="button" class="btn btn-outline-primary peyzaj-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="peyzajAltKalemForm"></div>`;  

  document.querySelectorAll('.peyzaj-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "Peyzaj - "+ PEYZAJ.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showPeyzaj);
    }  
  });  
}
function showMutfak(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">Mutfak - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="mutfakBtnGrup">${  
        MUTFAK.map(kal =>  
          `<button type="button" class="btn btn-outline-primary mutfak-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="mutfakAltKalemForm"></div>`;  

  document.querySelectorAll('.mutfak-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "Mutfak - "+ MUTFAK.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showMutfak);
    }  
  });  
}
function showIslakMekanlar(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">Islak Mekanlar - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="islakMekanlarBtnGrup">${  
        ISLAK_MEKANLAR.map(kal =>  
          `<button type="button" class="btn btn-outline-primary islak-mekanlar-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="islakMekanlarAltKalemForm"></div>`;  

  document.querySelectorAll('.islak-mekanlar-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "Islak Mekanlar - "+ ISLAK_MEKANLAR.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showIslakMekanlar);
    }  
  });  
}
function showIklimlendirme(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">Ä°klimlendirme - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="iklimlendirmeBtnGrup">${  
        IKLIMLENDIRME.map(kal =>  
          `<button type="button" class="btn btn-outline-primary iklimlendirme-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="iklimlendirmeAltKalemForm"></div>`;  

  document.querySelectorAll('.iklimlendirme-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "Ä°klimlendirme - "+ IKLIMLENDIRME.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showIklimlendirme);
    }  
  });  
}
function showDisCephe(){  
  document.getElementById('modalContentGenel').innerHTML =  
    `<div class="mb-3">  
      <div class="fw-bold fs-5 mb-2 text-center">DÄ±ÅŸ Cephe - Alt Kalem SeÃ§iniz:</div>  
      <div class="d-flex flex-wrap justify-content-center gap-3 mb-3" id="disCepheBtnGrup">${  
        DIS_CEPHE.map(kal =>  
          `<button type="button" class="btn btn-outline-primary dis-cephe-altkalem-btn mb-2"  
            data-kalem="${kal.id}">  
              <i class="fa-solid ${kal.icon} me-1"></i>${kal.ad}  
          </button>`  
        ).join("")  
      }</div>  
    </div>  
    <div id="disCepheAltKalemForm"></div>`;  

  document.querySelectorAll('.dis-cephe-altkalem-btn').forEach(b=>{  
    b.onclick = function(){  
      aktifAltKalem = this.getAttribute('data-kalem');  
      document.getElementById('modalBaslikText').textContent =  
        "DÄ±ÅŸ Cephe - "+ DIS_CEPHE.find(x=>x.id===aktifAltKalem).ad;  
      showOdemeEvrakForm(true, false, showDisCephe);
    }  
  });  
}


// 2. Ã–deme/Evrak Formu
function showOdemeEvrakForm(isRadyal=false, isEvrakIsleri=false, geriHandler=null){
  // BaÅŸlÄ±k ve anahtar belirleme
  let alanAciklamasi = '';
  if(isEvrakIsleri) {
    alanAciklamasi = `<div class="alert alert-info py-2 mb-2"> <b>${aktifEvrakKurum} - ${aktifEvrakDetay}</b> iÅŸlemi iÃ§in Ã¶deme ve evrak ekleyin.</div>`;
  }

  document.getElementById('modalContentGenel').innerHTML = `
    ${isRadyal? `  
    <div class="mb-2">  
      <button type="button" class="btn btn-link btn-sm ps-0 mb-2" id="geriRadyalBtn">  
        <i class="fa fa-chevron-left"></i> Alt Kalemler  
      </button>  
    </div>` : ''}
    ${alanAciklamasi}
    <div class="rowg">
      <div class="colg">
        <div class="card shadow-sm mb-3 w-100">
          <div class="card-header bg-light">
            <b class="text-primary"><i class="fa-solid fa-coins"></i> Ã–deme KayÄ±tlarÄ±</b>
          </div>
          <div class="card-body">
            <form id="odemeFormDinamik">
              <div class="row g-2">
                <div class="col-md-5">
                  <input type="text" class="form-control" id="odemeAciklama" placeholder="AÃ§Ä±klama" maxlength="100" required>
                </div>
                <div class="col-md-3">
                  <input type="number" class="form-control" id="odemeTutar" placeholder="Tutar (TL)" min="1" required>
                </div>
                <div class="col-md-4">
                  <input type="date" class="form-control" id="odemeTarih" required>
                </div>
              </div>
              <div class="d-flex justify-content-end mt-2">
                <button type="submit" class="btn btn-success btn-sm"><i class="fa-solid fa-plus"></i> Kaydet</button>
              </div>
            </form>
            <div class="table-responsive mt-3">
              <table class="table table-striped table-hover align-middle small shadow-sm rounded" id="odemeTablosu">
                <thead class="table-primary">
                  <tr>
                    <th>#</th>
                    <th>AÃ§Ä±klama</th>
                    <th>Tutar (TL)</th>
                    <th>Tarih</th>
                    <th>Ä°ÅŸlem</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
              <div id="odemeBosMesaj" class="text-center text-secondary mt-3" style="display:none;">HenÃ¼z Ã¶deme kaydÄ± girilmemiÅŸ.</div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-5 col-12 d-flex flex-column align-items-center mx-auto">
        <div class="card shadow-sm mb-3 w-100">
          <div class="card-header bg-light">
            <b class="text-primary"><i class="fa-solid fa-paperclip"></i> Evrak YÃ¼kle</b>
          </div>
          <div class="card-body pt-3 pb-2">
            <form id="evrakFormDinamik">
              <div class="input-group mb-2">
                <input type="file" class="form-control" id="evrakDosya" name="file" required>
              </div>
              <div class="mb-2">
                <input type="text" class="form-control" id="evrakAciklama" maxlength="100" placeholder="AÃ§Ä±klama (opsiyonel)">
              </div>
              <div class="d-flex justify-content-end">
                <button type="submit" class="btn btn-primary btn-sm"><i class="fa-solid fa-upload"></i> YÃ¼kle</button>
              </div>
            </form>
            <hr>
            <div>
              <h6 class="mb-1 text-secondary">YÃ¼klenen Evraklar:</h6>
              <ul class="list-group file-list" id="evrakListesi" style="font-size:0.97rem;"></ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  `;
  // Geri butonu olayÄ±
  if(isRadyal && typeof geriHandler === 'function') {
    document.getElementById('geriRadyalBtn').onclick = geriHandler;
  }
  document.getElementById('odemeFormDinamik').onsubmit = odemeFormSubmit;
  document.getElementById('evrakFormDinamik').onsubmit = evrakFormSubmit;
  tabloGuncelleDinamik(isEvrakIsleri);
  evrakGuncelleDinamik(isEvrakIsleri);
}  
// -- Dinamik Ã¶demeler
// Odeme formunu gÃ¶nder
function odemeFormSubmit(e){
  e.preventDefault();
  const aciklama = document.getElementById('odemeAciklama').value.trim();
  const tutar = Number(document.getElementById('odemeTutar').value);
  const tarih = document.getElementById('odemeTarih').value;
  let key = aktifAdimId ? (aktifAltKalem ? aktifAdimId+"_"+aktifAltKalem : aktifAdimId) : aktifEvrakKey;
  if(aciklama && tutar > 0 && tarih && key) {
    showLoader();
    fetch('/evrak', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          process:"save",
          userId, 
          projectName,
          aciklama, 
          tutar,
          tarih 
        })
      })
    .then(r => r.json())
    .then(() => tabloGuncelleDinamik(!!aktifEvrakKey))
    .finally(() => {
      hideLoader();
  });
    e.target.reset();
  }
}
function tabloGuncelleDinamik(isEvrakIsleri) {
  const tbody = document.querySelector('#odemeTablosu tbody');

  showLoader();

  fetch('/evrak', {
    method: 'POST',  
    headers: {  
        'Content-Type': 'application/json'  
    },
    credentials: 'include',
    body: JSON.stringify({
      process :"read",
      userId,
      projectName
    })
  })
    .then(r => r.json())
    .then(veri => {
      console.log("veri ",veri);
      tbody.innerHTML = '';
      if (!Array.isArray(veri) || veri.length === 0) {
        document.getElementById('odemeBosMesaj').style.display = '';
        document.getElementById('odemeTablosu').style.display = 'none';
      } else {
        document.getElementById('odemeBosMesaj').style.display = 'none';
        document.getElementById('odemeTablosu').style.display = '';
        veri.forEach((o, idx) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${idx + 1}</td>
            <td>${o.aciklama || ''}</td>
            <td>${o.tutar}</td>
            <td>${o.tarih}</td>
            <td>
              <button class="btn btn-sm btn-danger" title="Sil" onclick="silOdemeSunucu('${o._id}')">
                <i class="fa-solid fa-trash"></i>
              </button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      }
    })
    .finally(() => {
      hideLoader();
  });
}
async function silOdemeSunucu(odemeId) {
  const userConfirm = await showWarningMessage("KayÄ±t silinsin mi?","evet", false);
  if(!userConfirm) return;
  const userInputIndex = typeof aktifUserInputIndex !== 'undefined' ? aktifUserInputIndex : 0;
  const imarDurumuIndex = typeof aktifImarDurumuIndex !== 'undefined' ? aktifImarDurumuIndex : 0;

  showLoader();

  fetch('/evrak', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      process:"delete",
      userId,
      projectName,
      odemeId
    })
  })
  .then(r => r.json())
  .then(() => tabloGuncelleDinamik())
  .finally(() => {
      hideLoader(); // ArtÄ±k ne olursa olsun loader kapanÄ±r (baÅŸarÄ± ya da hata)
  });
}
window.silOdemeSunucu = silOdemeSunucu;
window.tabloGuncelleDinamik = tabloGuncelleDinamik;


async function evrakFormSubmit(e){
  e.preventDefault();
  const dosyaInput = document.getElementById('evrakDosya');
  const aciklamaInput = document.getElementById('evrakAciklama');
  const dosya = dosyaInput.files[0];
  if (!dosya) return;
  const aciklama = document.getElementById('evrakAciklama').value.trim();
  let key = aktifAdimId ? (aktifAltKalem ? aktifAdimId+"_"+aktifAltKalem : aktifAdimId) : aktifEvrakKey;
  if (!key) return;

  // DosyayÄ± Ã¶nce PDFâ€™e Ã§evir
  let pdfFile;
  try {
    pdfFile = await fileToPdfBlob(dosya);
  } catch(e) {
    dosyaInput.value = "";
    aciklamaInput.value = "";
    showWarningMessage("Dosya PDF veya resim deÄŸil!", "tamam", false);
    return;
  }

  showLoader();

  const formData = new FormData();
  formData.append('file', pdfFile);
  formData.append('aciklama', aciklama);
  formData.append('key', key);
  formData.append('process', "saveEvrak");
  formData.append('projectName', projectName);
  formData.append('userId', userId);

  fetch('/evrak', {
    method: 'POST',
    body: formData
  })
  .then(r => r.json())
  .then(() => {
      evrakGuncelleDinamik(!!aktifEvrakKey); 

      // --- Kutu iÃ§eriklerini temizle ---
      dosyaInput.value = "";
      aciklamaInput.value = "";
    })
    .finally(() => {
      hideLoader();
  });

  // EÄŸer form elemanÄ± ise, resetle (Ã¶zellikle onsubmit ile Ã§aÄŸrÄ±lÄ±yorsa)
  if (e.target && typeof e.target.reset === 'function') {
    e.target.reset();
  }
}
function fileToPdfBlob(file) {
  return new Promise((resolve, reject) => {
    if (file.type === "application/pdf") {
      // Zaten pdf, dosyayÄ± aynen kullan.
      resolve(file);
    } else if (file.type.startsWith("image/")) {
      // jsPDF ile resmi PDFe koyup blob yapalÄ±m
      const reader = new FileReader();
      reader.onload = function(e) {
        const imgData = e.target.result;
        const pdf = new window.jspdf.jsPDF(); // veya new jsPDF();
        pdf.addImage(imgData, 'JPEG', 10, 10, 180, 250);
        const pdfBlob = pdf.output("blob");
        resolve(new File([pdfBlob], file.name.replace(/\..+$/, ".pdf"), { type: "application/pdf" }));
      };
      reader.onerror = reject;
      reader.readAsDataURL(file);
    } else {
      // DiÄŸer dosya tÃ¼rleri iÃ§in uyarÄ±
      //alert("Sadece PDF veya resim yÃ¼kleyebilirsiniz!");
      reject("Desteklenmeyen dosya tÃ¼rÃ¼");
    }
  });
}

function evrakGuncelleDinamik() {
    const ul = document.getElementById('evrakListesi');
    fetch('/evrak', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            process:"readEvrak",
            userId,
            projectName // ve gerekirse imarDurumuIndex
        })
    })
    .then(r => r.json())
    .then(veri => {
        ul.innerHTML = '';
        if (!veri || veri.length === 0) {
            ul.innerHTML = `<li class="list-group-item text-secondary">Evrak yok veya yÃ¼klenmemiÅŸ.</li>`;
        } else {
            veri.forEach(ev => {
                const fileName = ev.fileName || ev.dosyaAdi || "evrak";
                const filePath = ev.path;
                const li = document.createElement('li');
                li.className = "list-group-item d-flex justify-content-between align-items-center";
                li.innerHTML = `
                    <span>
                        <i class="fa-solid fa-file-arrow-down me-1"></i>
                        <b>${fileName}</b>
                        <small class="text-muted">${ev.aciklama || ''}</small>
                        <button type="button"
                            class="btn btn-link btn-sm px-0 ms-1"
                            title="GÃ¶rÃ¼ntÃ¼le"
                            onclick="showEvrakModal('${filePath.replace(/'/g,"\\'")}', '${fileName.replace(/'/g,"\\'") }')">
                            <i class="fa fa-eye"></i>
                        </button>
                        <a href="${filePath}" download="${fileName}"
                            class="btn btn-link btn-sm px-0 ms-1" title="Ä°ndir">
                            <i class="fa fa-download"></i>
                        </a>
                    </span>
                    <button class="btn btn-outline-danger btn-sm" title="Sil" onclick="silEvrakSunucu('${ev._id}')">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                `;
                ul.appendChild(li);
            });
        }
    });
}
async function silEvrakSunucu(evrakId){
    const userConfirm = await showWarningMessage("KayÄ±t silinsin mi?","evet", false);
    if(!userConfirm) return;
    showLoader();
    fetch('/evrak', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({
            process:"deleteEvrak",
            userId,
            projectName,
            evrakId
        })
    })
    .then(r => r.json())
    .then(() => evrakGuncelleDinamik())
    .finally(() => {
      hideLoader();
  });
}
function showEvrakModal(fileUrl, fileName) {
    let content = '';

    const ext = fileName.split('.').pop().toLowerCase();

    if(['jpg','jpeg','png','gif','webp','bmp'].includes(ext)) {
        content = `<img src="${fileUrl}" class="img-fluid" alt="${fileName}">`;
    } else if(['pdf'].includes(ext)) {
        content = `<iframe src="${fileUrl}" style="width:100%; min-height:60vh; border:none"></iframe>`;
    } else {
        content = `Bu dosya tÃ¼rÃ¼ gÃ¶rÃ¼ntÃ¼lenemiyor.<br><a href="${fileUrl}" download class="btn btn-primary mt-3">Ä°ndir (${fileName})</a>`;
    }

    document.getElementById('evrakModalLabel').textContent = fileName;
    document.getElementById('evrakModalBody').innerHTML = content;

    const modal = new bootstrap.Modal(document.getElementById('evrakModal'));
    modal.show();
}
window.silEvrakSunucu = silEvrakSunucu;
window.evrakGuncelleDinamik = evrakGuncelleDinamik;
window.showEvrakModal = showEvrakModal;



    quatationButton.addEventListener("click", () => {
        window.location.href = `/quatation?projectName=${encodeURIComponent(projectName)}`;
    });
    graphsButton.addEventListener("click", () => {
        window.location.href = `/analiz?projectName=${encodeURIComponent(projectName)}`;
    });
    soldButton.addEventListener("click", () => {
        window.location.href = `/sold?projectName=${encodeURIComponent(projectName)}`;
    });
    buttonHome.addEventListener("click", () => {  
        window.location.href = `/draw?projectName=${encodeURIComponent(projectName)}`;
    });

    function showLoader() {
        document.getElementById('loader').style.display = 'flex';
    }
    function hideLoader() {
        document.getElementById('loader').style.display = 'none';
    }

</script>
</body>
</html>
